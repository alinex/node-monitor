<!DOCTYPE html>
<html>
<head>
  <title>prompt.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../";
    var thisFile = "src/prompt.coffee";
    var defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0" /></head>
<body>
  <nav>
<div class="logo"><a href="http://alinex.github.io"
  onmouseover="logo.src='https://alinex.github.io/images/Alinex-200.png'"
  onmouseout="logo.src='https://alinex.github.io/images/Alinex-black-200.png'">
  <img name="logo" src="https://alinex.github.io/images/Alinex-black-200.png"
    width="150" title="Alinex Universe Homepage" />
  </a>
  <img src="http://alinex.github.io/images/Alinex-200.png"
    style="display:none" alt="preloading" />
</div>
<div class="links">
  <a href="http://alinex.github.io/blog"
    class="btn btn-primary"><span class="glyphicon-pencil"></span> Blog</a>
  <a href="http://alinex.github.io/develop"
    class="btn btn-primary"><span class="glyphicon-book"></span> Develop</a>
  <a href="http://alinex.github.io/code.html"
    class="btn btn-warning"><span class="glyphicon-cog"></span> Code</a>
</div>
</nav><div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#prompt-interactive-console">Prompt (Interactive Console)</a>
      </div>

      <div class="heading h2">
        <a href="#node-modules">Node Modules</a>
      </div>

      <div class="heading h2">
        <a href="#setup">Setup</a>
      </div>

      <div class="heading h2">
        <a href="#commands">Commands</a>
      </div>

      <div class="heading h3">
        <a href="#integrated-help">Integrated help</a>
      </div>

      <div class="heading h3">
        <a href="#exit-console">exit console</a>
      </div>

      <div class="heading h3">
        <a href="#list-elements-of-type">list elements of type</a>
      </div>

      <div class="heading h3">
        <a href="#show-element">Show element</a>
      </div>

      <div class="heading h2">
        <a href="#interactive-console">Interactive Console</a>
      </div>

      <div class="heading h2">
        <a href="#direct-command-execution">Direct command execution</a>
      </div>

      <div class="heading h2">
        <a href="#helper-methods">Helper methods</a>
      </div>

      <div class="heading h3">
        <a href="#ask-for-the-next-command">ask for the next command</a>
      </div>

      <div class="heading h3">
        <a href="#error-management">Error management</a>
      </div>

      <div class="heading h3">
        <a href="#ask-for-missing-data">Ask for missing data</a>
      </div>

      <div class="heading h3">
        <a href="#ask-user-to-give-the-data-for-the-schema">Ask user to give the data for the schema</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container" tabindex="0"><a id="fork" href="https://github.com/alinex/node-monitor" title="Fork me on GitHub"></a>
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="prompt-interactive-console">
  <h1>
    <a href="#prompt-interactive-console" name="prompt-interactive-console" class="pilcrow"></a>
Prompt (Interactive Console)
  </h1>
</div>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="node-modules">
  <h2>
    <a href="#node-modules" name="node-modules" class="pilcrow"></a>
Node Modules
  </h2>
</div>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>include base modules</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">chalk = <span class="hljs-built_in">require</span> <span class="hljs-string">'chalk'</span>
os = <span class="hljs-built_in">require</span> <span class="hljs-string">'os'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>include alinex modules</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">async = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-async'</span>
config = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-config'</span>
{string} = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-util'</span>
Report = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-report'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>include classes and helpers</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">monitor = <span class="hljs-built_in">require</span> <span class="hljs-string">'./index'</span>
Check = <span class="hljs-built_in">require</span> <span class="hljs-string">'./check'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>set to true if interactive console is running</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">interactive = <span class="hljs-literal">false</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="setup">
  <h2>
    <a href="#setup" name="setup" class="pilcrow"></a>
Setup
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">
types = [<span class="hljs-string">'controller'</span>, <span class="hljs-string">'sensor'</span>, <span class="hljs-string">'actor'</span>, <span class="hljs-string">'analyzer'</span>]</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="commands">
  <h2>
    <a href="#commands" name="commands" class="pilcrow"></a>
Commands
  </h2>
</div>
<p>Each key in the following object is a command with the following fields:</p>
<ul>
<li>description - a short description line</li>
<li>help - a specific help text (optional, markdown possible)</li>
<li>commands(parts) - method to get a command completion array (optional)</li>
<li>run(parts, cb) - do the task</li>
</ul>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">commands =</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="integrated-help">
  <h3>
    <a href="#integrated-help" name="integrated-help" class="pilcrow"></a>
Integrated help
  </h3>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  help:
    description: <span class="hljs-string">"list a help page with possible commands"</span>
    commands: <span class="hljs-function">-&gt;</span>
      Object.keys commands
      .filter (e) -&gt; e <span class="hljs-keyword">isnt</span> <span class="hljs-string">'help'</span>
      .map (e) -&gt; <span class="hljs-string">"help <span class="hljs-subst">#{e}</span>"</span>
    run: <span class="hljs-function"><span class="hljs-params">(args, data, cb)</span> -&gt;</span>
      report = <span class="hljs-keyword">new</span> Report()
      <span class="hljs-keyword">if</span> args.length &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> args[<span class="hljs-number">1</span>] <span class="hljs-keyword">in</span> Object.keys commands</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>specific help for one command</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">        cmd = args[<span class="hljs-number">1</span>]
        report.h1 <span class="hljs-string">"Help for <span class="hljs-subst">#{cmd}</span> command"</span>
        report.p <span class="hljs-string">"This command will <span class="hljs-subst">#{commands[cmd].description}</span>."</span>
        report.add commands[cmd].help() <span class="hljs-keyword">if</span> commands[cmd].help?
        <span class="hljs-built_in">console</span>.log report.toConsole()
        <span class="hljs-keyword">return</span> cb()</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>General help page</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      report.h1 <span class="hljs-string">"Help for interactive console"</span>
      report.p <span class="hljs-string">"Within this interactive console you can use different
      commands with sub arguments to run. See the list of possibilities below.
      You can also use code completion to get a list of available commands."</span>
      report.p <span class="hljs-string">"To close this console use Ctrl-C or the
</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>{Report.b 'exit'} command.&quot;</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      report.p <span class="hljs-string">"The following commands are possible:"</span>
      report.ul Object.keys(commands).map (name) -&gt;
        <span class="hljs-string">"<span class="hljs-subst">#{string.rpad name, <span class="hljs-number">10</span>}</span> <span class="hljs-subst">#{commands[name].description}</span>"</span>
      report.p <span class="hljs-string">"To get more information about a specific command and
      its additional arguments type <span class="hljs-subst">#{Report.b <span class="hljs-string">'help &lt;command&gt;'</span>}</span>."</span>
      <span class="hljs-built_in">console</span>.log report.toConsole()
      cb()</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="exit-console">
  <h3>
    <a href="#exit-console" name="exit-console" class="pilcrow"></a>
exit console
  </h3>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  exit:
    description: <span class="hljs-string">"close the console"</span>
    help: <span class="hljs-function">-&gt;</span>
      report = <span class="hljs-keyword">new</span> Report()
      report.p <span class="hljs-string">"You may also type `Ctrl` + `C` to exit ungraceful. But be patient
      till the program exits. This may take some time to close opened connections."</span>
    run: <span class="hljs-function">-&gt;</span>
      exit()</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>change verbose level</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  set:
    description: <span class="hljs-string">"change general or specific settings"</span>
    help: <span class="hljs-function">-&gt;</span>
      report = <span class="hljs-keyword">new</span> Report()
      report.box <span class="hljs-string">"Usage: __set &lt;option&gt; [&lt;value&gt;]"</span>, <span class="hljs-string">'info'</span>
      report.p <span class="hljs-string">"The following parameters may be changed:"</span>
      report.ul [
        <span class="hljs-string">"verbose - run in verbose mode (integer for verbose level 0..9)"</span>
        <span class="hljs-string">"try     - try run which prevent actors to run (boolean)"</span>
      ]
      report.p <span class="hljs-string">"The changes will take effect on the next command."</span>
    commands: <span class="hljs-function"><span class="hljs-params">(parts)</span> -&gt;</span>
      subcmd = [<span class="hljs-string">'try'</span>, <span class="hljs-string">'verbose'</span>] <span class="hljs-comment">#, 'controller']</span>
      <span class="hljs-keyword">if</span> parts.length <span class="hljs-keyword">is</span> <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> parts[<span class="hljs-number">1</span>] <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> subcmd
        subcmd.map (e) -&gt; <span class="hljs-string">"<span class="hljs-subst">#{parts[<span class="hljs-number">0</span>]}</span> <span class="hljs-subst">#{e}</span>"</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> parts[<span class="hljs-number">1</span>] <span class="hljs-keyword">is</span> <span class="hljs-string">'verbose'</span>
        <span class="hljs-keyword">if</span> parts.length <span class="hljs-keyword">is</span> <span class="hljs-number">2</span> <span class="hljs-keyword">or</span> Number(parts[<span class="hljs-number">2</span>]) <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.9</span>]
          [<span class="hljs-number">0.</span><span class="hljs-number">.9</span>].map (e) -&gt; <span class="hljs-string">"<span class="hljs-subst">#{parts[<span class="hljs-number">0</span>]}</span> <span class="hljs-subst">#{parts[<span class="hljs-number">1</span>]}</span> <span class="hljs-subst">#{e}</span>"</span>
        <span class="hljs-keyword">else</span>
          []
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> parts[<span class="hljs-number">1</span>] <span class="hljs-keyword">is</span> <span class="hljs-string">'try'</span>
        <span class="hljs-keyword">if</span> parts.length <span class="hljs-keyword">is</span> <span class="hljs-number">2</span> <span class="hljs-keyword">or</span> parts[<span class="hljs-number">2</span>] <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> [<span class="hljs-string">'true'</span>, <span class="hljs-string">'false'</span>]
          [<span class="hljs-string">'true'</span>, <span class="hljs-string">'false'</span>].map (e) -&gt; <span class="hljs-string">"<span class="hljs-subst">#{parts[<span class="hljs-number">0</span>]}</span> <span class="hljs-subst">#{parts[<span class="hljs-number">1</span>]}</span> <span class="hljs-subst">#{e}</span>"</span>
        <span class="hljs-keyword">else</span>
          []
      <span class="hljs-keyword">else</span>
        []
    run: <span class="hljs-function"><span class="hljs-params">(args, data, cb)</span> -&gt;</span>
      <span class="hljs-keyword">unless</span> <span class="hljs-number">1</span> &lt; args.length &lt; <span class="hljs-number">4</span>
        <span class="hljs-built_in">console</span>.log chalk.red <span class="hljs-string">"Wrong number of parameters for command <span class="hljs-subst">#{chalk.bold <span class="hljs-string">'set'</span>}</span>
        use <span class="hljs-subst">#{chalk.bold <span class="hljs-string">'help set'</span>}</span> for more information!"</span>
        <span class="hljs-keyword">return</span> cb()
      <span class="hljs-keyword">if</span> args.length <span class="hljs-keyword">is</span> <span class="hljs-number">3</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>set</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">        <span class="hljs-keyword">switch</span> args[<span class="hljs-number">1</span>]
          <span class="hljs-keyword">when</span> <span class="hljs-string">'verbose'</span>
            num = Number args[<span class="hljs-number">2</span>] <span class="hljs-keyword">if</span> args[<span class="hljs-number">2</span>]?
            <span class="hljs-keyword">if</span> isNaN num
              <span class="hljs-built_in">console</span>.log chalk.red <span class="hljs-string">"The value <span class="hljs-subst">#{args[<span class="hljs-number">2</span>]}</span> is not a number."</span>
              <span class="hljs-keyword">return</span> cb()
            monitor.mode.verbose = num
          <span class="hljs-keyword">when</span> <span class="hljs-string">'try'</span>
            <span class="hljs-keyword">unless</span> args[<span class="hljs-number">2</span>] <span class="hljs-keyword">in</span> [<span class="hljs-string">'true'</span>, <span class="hljs-string">'false'</span>]
              <span class="hljs-built_in">console</span>.log chalk.red <span class="hljs-string">"The value <span class="hljs-subst">#{args[<span class="hljs-number">2</span>]}</span> is not a number."</span>
              <span class="hljs-keyword">return</span> cb()
            monitor.mode.<span class="hljs-keyword">try</span> = args[<span class="hljs-number">2</span>] <span class="hljs-keyword">is</span> <span class="hljs-string">'true'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>output</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      <span class="hljs-keyword">switch</span> args[<span class="hljs-number">1</span>]
        <span class="hljs-keyword">when</span> <span class="hljs-string">'verbose'</span>
          <span class="hljs-built_in">console</span>.log chalk.grey <span class="hljs-string">"Verbosity set to level <span class="hljs-subst">#{monitor.mode.verbose}</span>"</span>
          cb()
        <span class="hljs-keyword">when</span> <span class="hljs-string">'try'</span>
          <span class="hljs-built_in">console</span>.log chalk.grey <span class="hljs-string">"Try mode is set to <span class="hljs-subst">#{monitor.mode.<span class="hljs-keyword">try</span>}</span>"</span>
          cb()
        <span class="hljs-keyword">else</span>
          <span class="hljs-built_in">console</span>.log chalk.red <span class="hljs-string">"Unknown setting <span class="hljs-subst">#{args[<span class="hljs-number">1</span>]}</span> in command."</span>
          cb()</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="list-elements-of-type">
  <h3>
    <a href="#list-elements-of-type" name="list-elements-of-type" class="pilcrow"></a>
list elements of type
  </h3>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  list:
    description: <span class="hljs-string">"show the list of possible elements"</span>
    help: <span class="hljs-function">-&gt;</span>
      report = <span class="hljs-keyword">new</span> Report()
      report.box <span class="hljs-string">"Usage: <span class="hljs-subst">#{Report.b <span class="hljs-string">'list &lt;type&gt;'</span>}</span>"</span>, <span class="hljs-string">'info'</span>
      report.p <span class="hljs-string">"The list command will display a list of elements for the specified `type`:"</span>
      report.ul types
    commands: <span class="hljs-function"><span class="hljs-params">(parts)</span> -&gt;</span>
      <span class="hljs-keyword">if</span> parts.length <span class="hljs-keyword">is</span> <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> parts[<span class="hljs-number">1</span>] <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> types
        types.map (e) -&gt; <span class="hljs-string">"<span class="hljs-subst">#{parts[<span class="hljs-number">0</span>]}</span> <span class="hljs-subst">#{e}</span>"</span>
      <span class="hljs-keyword">else</span>
        []
    run: <span class="hljs-function"><span class="hljs-params">(args, data, cb)</span> -&gt;</span>
      <span class="hljs-keyword">unless</span> args.length <span class="hljs-keyword">is</span> <span class="hljs-number">2</span>
        <span class="hljs-built_in">console</span>.log chalk.red <span class="hljs-string">"Wrong number of parameters for command <span class="hljs-subst">#{chalk.bold <span class="hljs-string">'list'</span>}</span>
        use <span class="hljs-subst">#{chalk.bold <span class="hljs-string">'help list'</span>}</span> for more information!"</span>
        <span class="hljs-keyword">return</span> cb()
      <span class="hljs-keyword">switch</span> args[<span class="hljs-number">1</span>]
        <span class="hljs-keyword">when</span> <span class="hljs-string">'controller'</span>
          conf = config.get <span class="hljs-string">'/monitor/controller'</span>
          <span class="hljs-built_in">console</span>.log chalk.bold <span class="hljs-string">"Controllers:"</span>
          <span class="hljs-keyword">for</span> el <span class="hljs-keyword">in</span> monitor.listController()
            <span class="hljs-built_in">console</span>.log <span class="hljs-string">"  - <span class="hljs-subst">#{el}</span> <span class="hljs-subst">#{chalk.gray conf[el].name}</span>"</span>
        <span class="hljs-keyword">when</span> <span class="hljs-string">'sensor'</span>
          <span class="hljs-built_in">console</span>.log chalk.bold <span class="hljs-string">"Sensors:"</span>
          <span class="hljs-keyword">for</span> el <span class="hljs-keyword">in</span> monitor.listSensor()
            <span class="hljs-built_in">console</span>.log <span class="hljs-string">"  - <span class="hljs-subst">#{el}</span>"</span>
        <span class="hljs-keyword">else</span>
          <span class="hljs-built_in">console</span>.log chalk.red <span class="hljs-string">"Given type <span class="hljs-subst">#{chalk.bold args[<span class="hljs-number">1</span>]}</span> not possible in
</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>{chalk.bold 'list'} command. Use #{chalk.bold 'help list'} for more</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">          information!<span class="hljs-string">"
      cb()

</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="show-element">
  <h3>
    <a href="#show-element" name="show-element" class="pilcrow"></a>
Show element
  </h3>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  show:
    description: <span class="hljs-string">"get more information about the element"</span>
    help: <span class="hljs-function">-&gt;</span>
      report = <span class="hljs-keyword">new</span> Report()
      report.box <span class="hljs-string">"Usage: <span class="hljs-subst">#{Report.b <span class="hljs-string">'show &lt;type&gt; &lt;element&gt;'</span>}</span>"</span>, <span class="hljs-string">'info'</span>
      report.p <span class="hljs-string">"The show command will display detailed information about the specified `type`:"</span>
      report.ul types
      report.p <span class="hljs-string">"Use code completion by typing `TAB` to get a list of possible
      elements."</span>
    commands: <span class="hljs-function"><span class="hljs-params">(parts)</span> -&gt;</span>
      <span class="hljs-keyword">if</span> parts.length <span class="hljs-keyword">is</span> <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> parts[<span class="hljs-number">1</span>] <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> types
        types.map (e) -&gt; <span class="hljs-string">"<span class="hljs-subst">#{parts[<span class="hljs-number">0</span>]}</span> <span class="hljs-subst">#{e}</span>"</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> parts.length &gt; <span class="hljs-number">2</span> <span class="hljs-comment"># only allow one element</span>
        []
      <span class="hljs-keyword">else</span>
        num = <span class="hljs-number">1</span>
        elements = <span class="hljs-keyword">switch</span> parts[<span class="hljs-number">1</span>]
          <span class="hljs-keyword">when</span> <span class="hljs-string">'controller'</span> <span class="hljs-keyword">then</span> monitor.listController()
          <span class="hljs-keyword">when</span> <span class="hljs-string">'sensor'</span> <span class="hljs-keyword">then</span> monitor.listSensor()
          <span class="hljs-keyword">else</span> []
        num++ <span class="hljs-keyword">while</span> parts[num+<span class="hljs-number">1</span>] <span class="hljs-keyword">in</span> elements
        line = parts[<span class="hljs-number">0.</span>.num].join <span class="hljs-string">' '</span>
        elements.map (e) -&gt; <span class="hljs-string">"<span class="hljs-subst">#{line}</span> <span class="hljs-subst">#{e}</span>"</span>
    run: <span class="hljs-function"><span class="hljs-params">(args, data, cb)</span> -&gt;</span>
      <span class="hljs-keyword">unless</span> args.length &gt; <span class="hljs-number">2</span>
        <span class="hljs-built_in">console</span>.log chalk.red <span class="hljs-string">"Too less parameters for command <span class="hljs-subst">#{chalk.bold <span class="hljs-string">'show'</span>}</span>
        use <span class="hljs-subst">#{chalk.bold <span class="hljs-string">'help show'</span>}</span> for more information!"</span>
        <span class="hljs-keyword">return</span> cb()
      <span class="hljs-keyword">switch</span> args[<span class="hljs-number">1</span>]
        <span class="hljs-keyword">when</span> <span class="hljs-string">'controller'</span>
          conf = config.get <span class="hljs-string">"/monitor/controller/<span class="hljs-subst">#{args[<span class="hljs-number">2</span>]}</span>"</span>
          <span class="hljs-keyword">unless</span> conf
            <span class="hljs-built_in">console</span>.log chalk.red <span class="hljs-string">"Given controller <span class="hljs-subst">#{chalk.bold args[<span class="hljs-number">2</span>]}</span> not defined.
            Maybe use <span class="hljs-subst">#{chalk.bold <span class="hljs-string">'list controller'</span>}</span> for a list of possible ones."</span>
            <span class="hljs-keyword">return</span> cb()
          monitor.showController args[<span class="hljs-number">2</span>], <span class="hljs-function"><span class="hljs-params">(err, report)</span> -&gt;</span>
            <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err
            <span class="hljs-built_in">console</span>.log report.toConsole()
            cb()
        <span class="hljs-keyword">when</span> <span class="hljs-string">'sensor'</span>
          check = <span class="hljs-keyword">new</span> Check
            sensor: args[<span class="hljs-number">2</span>]
          check.init (err) -&gt;
            <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err
            <span class="hljs-built_in">console</span>.log check.report().toConsole()
            cb()
        <span class="hljs-keyword">else</span>
          <span class="hljs-built_in">console</span>.log chalk.red <span class="hljs-string">"Given type <span class="hljs-subst">#{chalk.bold args[<span class="hljs-number">1</span>]}</span> not possible in
</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>{chalk.bold 'show'} command. Use #{chalk.bold 'show list'} for more</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">          information!<span class="hljs-string">"
          cb()

</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>Run element</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  run:
    description: <span class="hljs-string">"run the specified element"</span>
    help: <span class="hljs-function">-&gt;</span>
      report = <span class="hljs-keyword">new</span> Report()
      report.box <span class="hljs-string">"Usage: <span class="hljs-subst">#{Report.b <span class="hljs-string">'run &lt;type&gt; &lt;element&gt;'</span>}</span>"</span>, <span class="hljs-string">'info'</span>
      report.p <span class="hljs-string">"The run command will start a specified element which type is one of:"</span>
      report.ul types
      report.p <span class="hljs-string">"Use code completion by typing `TAB` to get a list of possible
      elements."</span>
    commands: <span class="hljs-function"><span class="hljs-params">(parts)</span> -&gt;</span>
      <span class="hljs-keyword">if</span> parts.length <span class="hljs-keyword">is</span> <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> parts[<span class="hljs-number">1</span>] <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> types
        types.map (e) -&gt; <span class="hljs-string">"<span class="hljs-subst">#{parts[<span class="hljs-number">0</span>]}</span> <span class="hljs-subst">#{e}</span>"</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> parts.length &gt; <span class="hljs-number">3</span> <span class="hljs-comment"># only allow one element</span>
        []
      <span class="hljs-keyword">else</span>
        num = <span class="hljs-number">1</span>
        elements = <span class="hljs-keyword">switch</span> parts[<span class="hljs-number">1</span>]
          <span class="hljs-keyword">when</span> <span class="hljs-string">'controller'</span>
            <span class="hljs-keyword">if</span> parts[<span class="hljs-number">2</span>] <span class="hljs-keyword">in</span> monitor.listController() <span class="hljs-keyword">then</span>  [] <span class="hljs-keyword">else</span> monitor.listController()
          <span class="hljs-keyword">when</span> <span class="hljs-string">'sensor'</span>
            <span class="hljs-keyword">if</span> parts[<span class="hljs-number">2</span>] <span class="hljs-keyword">in</span> monitor.listSensor() <span class="hljs-keyword">then</span> [] <span class="hljs-keyword">else</span> monitor.listSensor()
          <span class="hljs-keyword">else</span> []
        num++ <span class="hljs-keyword">while</span> parts[num+<span class="hljs-number">1</span>] <span class="hljs-keyword">in</span> elements
        line = parts[<span class="hljs-number">0.</span>.num].join <span class="hljs-string">' '</span>
        elements.map (e) -&gt; <span class="hljs-string">"<span class="hljs-subst">#{line}</span> <span class="hljs-subst">#{e}</span>"</span>
    run: <span class="hljs-function"><span class="hljs-params">(args, data, cb)</span> -&gt;</span>
      <span class="hljs-keyword">if</span> args.length <span class="hljs-keyword">is</span> <span class="hljs-number">1</span>
        <span class="hljs-built_in">console</span>.log chalk.red <span class="hljs-string">"Too less parameters for command <span class="hljs-subst">#{chalk.bold <span class="hljs-string">'show'</span>}</span>
        use <span class="hljs-subst">#{chalk.bold <span class="hljs-string">'help show'</span>}</span> for more information!"</span>
        <span class="hljs-keyword">return</span> cb()
      <span class="hljs-keyword">switch</span> args[<span class="hljs-number">1</span>]
        <span class="hljs-keyword">when</span> <span class="hljs-string">'controller'</span>
          <span class="hljs-keyword">if</span> args[<span class="hljs-number">2</span>]
            conf = config.get <span class="hljs-string">"/monitor/controller/<span class="hljs-subst">#{args[<span class="hljs-number">2</span>]}</span>"</span>
            <span class="hljs-keyword">unless</span> conf
              <span class="hljs-built_in">console</span>.log chalk.red <span class="hljs-string">"Given controller <span class="hljs-subst">#{chalk.bold args[<span class="hljs-number">2</span>]}</span> not defined.
              Maybe use <span class="hljs-subst">#{chalk.bold <span class="hljs-string">'list controller'</span>}</span> for a list of possible ones."</span>
              <span class="hljs-keyword">return</span> cb()
          monitor.runController args[<span class="hljs-number">2</span>], <span class="hljs-function"><span class="hljs-params">(err)</span> -&gt;</span>
            <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err
            <span class="hljs-built_in">console</span>.log chalk.grey <span class="hljs-string">"DONE"</span>
            cb()
        <span class="hljs-keyword">when</span> <span class="hljs-string">'sensor'</span>
          <span class="hljs-keyword">unless</span> args.length &gt; <span class="hljs-number">2</span>
            <span class="hljs-built_in">console</span>.log chalk.red <span class="hljs-string">"Too less parameters for command <span class="hljs-subst">#{chalk.bold <span class="hljs-string">'show'</span>}</span>
            use <span class="hljs-subst">#{chalk.bold <span class="hljs-string">'help show'</span>}</span> for more information!"</span>
            <span class="hljs-keyword">return</span> cb()</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>ask for data if not given</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">          askForSensor args[<span class="hljs-number">2</span>], data, <span class="hljs-function"><span class="hljs-params">(err, data)</span> -&gt;</span>
            <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>init check</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">            check = <span class="hljs-keyword">new</span> Check
              sensor: args[<span class="hljs-number">2</span>]
              config: data
            check.init (err) -&gt;
              <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>and run it</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">              check.run (err) -&gt;
                <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err
                <span class="hljs-built_in">console</span>.log check.report().toConsole()
                cb()
        <span class="hljs-keyword">else</span>
          <span class="hljs-built_in">console</span>.log chalk.red <span class="hljs-string">"Given type <span class="hljs-subst">#{chalk.bold args[<span class="hljs-number">1</span>]}</span> not possible in
</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>{chalk.bold 'show'} command. Use #{chalk.bold 'show list'} for more</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">          information!<span class="hljs-string">"
          cb()


</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="interactive-console">
  <h2>
    <a href="#interactive-console" name="interactive-console" class="pilcrow"></a>
Interactive Console
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.interactive = <span class="hljs-function"><span class="hljs-params">(conf, data)</span> -&gt;</span>
  <span class="hljs-built_in">console</span>.log <span class="hljs-string">"""
    \nWelcome to the <span class="hljs-subst">#{chalk.bold <span class="hljs-string">'interactive monitor console'</span>}</span> in which you can get more
    information about special tools, run individual tests and explore systems.

    To get help call the command <span class="hljs-subst">#{chalk.bold <span class="hljs-string">'help'</span>}</span> and close with <span class="hljs-subst">#{chalk.bold <span class="hljs-string">'exit'</span>}</span>!
  """</span>
  interactive = <span class="hljs-literal">true</span>
  async.forever (cb) -&gt;
    getCommand data, cb
  , <span class="hljs-function"><span class="hljs-params">(err)</span> -&gt;</span>
    exit <span class="hljs-number">1</span>, err</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="direct-command-execution">
  <h2>
    <a href="#direct-command-execution" name="direct-command-execution" class="pilcrow"></a>
Direct command execution
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.run = <span class="hljs-function"><span class="hljs-params">(args, data = {}, cb = -&gt;)</span> -&gt;</span>
  <span class="hljs-built_in">console</span>.log <span class="hljs-string">''</span>
  command = args[<span class="hljs-number">0</span>]
  <span class="hljs-keyword">if</span> commands[command]?
    commands[command].run args, data, <span class="hljs-function"><span class="hljs-params">(err)</span> -&gt;</span>
      <span class="hljs-built_in">console</span>.log <span class="hljs-string">''</span>
      cb err
  <span class="hljs-keyword">else</span>
    cb <span class="hljs-keyword">new</span> Error <span class="hljs-string">"Unknown command <span class="hljs-subst">#{chalk.bold command}</span> use
</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>{chalk.bold 'help'} for more information!&quot;</p>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="helper-methods">
  <h2>
    <a href="#helper-methods" name="helper-methods" class="pilcrow"></a>
Helper methods
  </h2>
</div>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="ask-for-the-next-command">
  <h3>
    <a href="#ask-for-the-next-command" name="ask-for-the-next-command" class="pilcrow"></a>
ask for the next command
  </h3>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript"><span class="hljs-function"><span class="hljs-title">getCommand</span> = <span class="hljs-params">(data, cb)</span> -&gt;</span>
  <span class="hljs-built_in">require</span>(<span class="hljs-string">'readline-history'</span>).createInterface
    input: process.stdin
    output: process.stdout
    completer: <span class="hljs-function"><span class="hljs-params">(line)</span> -&gt;</span>
      parts = line.trim().split <span class="hljs-regexp">/\s+/</span>
      list = Object.keys commands
      <span class="hljs-keyword">if</span> parts[<span class="hljs-number">0</span>] <span class="hljs-keyword">in</span> list <span class="hljs-keyword">and</span> commands[parts[<span class="hljs-number">0</span>]].commands
        list = commands[parts[<span class="hljs-number">0</span>]].commands parts
      hits = list.filter (c) -&gt;
        c.indexOf(line) <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
      .map (e) -&gt; <span class="hljs-string">"<span class="hljs-subst">#{e}</span> "</span>
      [
        <span class="hljs-keyword">if</span> hits.length <span class="hljs-keyword">then</span> hits <span class="hljs-keyword">else</span> list
        line
      ]
    path: <span class="hljs-string">"<span class="hljs-subst">#{os.tmpdir()}</span>/<span class="hljs-subst">#{process.title}</span>-history"</span>
    maxLength: <span class="hljs-number">1000</span>
    next: <span class="hljs-function"><span class="hljs-params">(readline)</span> -&gt;</span>
      readline.<span class="hljs-literal">on</span> <span class="hljs-string">'SIGINT'</span>, <span class="hljs-function">-&gt;</span> exit <span class="hljs-number">130</span>, <span class="hljs-keyword">new</span> Error <span class="hljs-string">"Got SIGINT signal"</span>
      <span class="hljs-built_in">console</span>.log <span class="hljs-string">''</span>
      readline.question <span class="hljs-string">'monitor&gt; '</span>, <span class="hljs-function"><span class="hljs-params">(line)</span> -&gt;</span>
        readline.close()
        <span class="hljs-built_in">console</span>.log <span class="hljs-string">''</span>
        args = line.trim().split <span class="hljs-regexp">/\s+/</span>
        command = args[<span class="hljs-number">0</span>]
        <span class="hljs-keyword">if</span> commands[command]?
          commands[command].run args, data, cb
        <span class="hljs-keyword">else</span>
          <span class="hljs-built_in">console</span>.log chalk.red <span class="hljs-string">"Unknown command <span class="hljs-subst">#{chalk.bold command}</span> use
</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>{chalk.bold 'help'} for more information!&quot;</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">          cb()</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="error-management">
  <h3>
    <a href="#error-management" name="error-management" class="pilcrow"></a>
Error management
  </h3>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript"><span class="hljs-function"><span class="hljs-title">exit</span> = <span class="hljs-params">(code = <span class="hljs-number">0</span>, err)</span> -&gt;</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>exit without error</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  process.exit code <span class="hljs-keyword">unless</span> err</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<p>exit with error</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-built_in">console</span>.error chalk.red.bold <span class="hljs-string">"FAILED: <span class="hljs-subst">#{err.message}</span>"</span>
  <span class="hljs-built_in">console</span>.error err.description <span class="hljs-keyword">if</span> err.description
  process.exit code</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="ask-for-missing-data">
  <h3>
    <a href="#ask-for-missing-data" name="ask-for-missing-data" class="pilcrow"></a>
Ask for missing data
  </h3>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript"><span class="hljs-function"><span class="hljs-title">askForSensor</span> = <span class="hljs-params">(type, data, cb)</span> -&gt;</span>
  <span class="hljs-keyword">return</span>  cb() <span class="hljs-keyword">unless</span> interactive
  monitor.getSensor type, <span class="hljs-function"><span class="hljs-params">(err, sensor)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err
    askFor sensor.schema, data, cb</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="ask-user-to-give-the-data-for-the-schema">
  <h3>
    <a href="#ask-user-to-give-the-data-for-the-schema" name="ask-user-to-give-the-data-for-the-schema" class="pilcrow"></a>
Ask user to give the data for the schema
  </h3>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript"><span class="hljs-function"><span class="hljs-title">askFor</span> = <span class="hljs-params">(schema, predef = {}, cb)</span> -&gt;</span>
  validator = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-validator'</span>
  <span class="hljs-built_in">console</span>.log <span class="hljs-string">"""Give the settings to run this (default is used if nothing given).
  Type 'null' to clear default value."""</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<p>for each key</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  data = {}
  async.eachSeries Object.keys(schema.keys), <span class="hljs-function"><span class="hljs-params">(key, cb)</span> -&gt;</span>
    def = schema.keys[key]</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<p>ask for each one</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    base = predef[key] ? def.default
    readline = <span class="hljs-built_in">require</span>(<span class="hljs-string">'readline'</span>).createInterface
      input: process.stdin
      output: process.stdout
      completer: <span class="hljs-function"><span class="hljs-params">(line)</span> -&gt;</span>
        list = def.values ? []
        hits = list.filter (c) -&gt;
          c.indexOf(line) <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
        [
          <span class="hljs-keyword">if</span> hits.length <span class="hljs-keyword">then</span> hits <span class="hljs-keyword">else</span> list
          line
        ]
    async.retry <span class="hljs-number">3</span>, <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span>
      readline.question <span class="hljs-string">"<span class="hljs-subst">#{def.title}</span><span class="hljs-subst">#{<span class="hljs-keyword">if</span> base? <span class="hljs-keyword">then</span> <span class="hljs-string">' ('</span> + base + <span class="hljs-string">')'</span> <span class="hljs-keyword">else</span> <span class="hljs-string">''</span>}</span>: "</span>, <span class="hljs-function"><span class="hljs-params">(line)</span> -&gt;</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<p>get result</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">        line = <span class="hljs-keyword">switch</span>
          <span class="hljs-keyword">when</span> line <span class="hljs-keyword">is</span> <span class="hljs-string">'null'</span> <span class="hljs-keyword">then</span> <span class="hljs-literal">null</span>
          <span class="hljs-keyword">when</span> line <span class="hljs-keyword">then</span> line
          <span class="hljs-keyword">else</span> base</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>validate</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">        validator.check
          name: <span class="hljs-string">'userResponse'</span>
          value: line
          schema: def
        , <span class="hljs-function"><span class="hljs-params">(err, result)</span> -&gt;</span>
          <span class="hljs-keyword">if</span> err
            <span class="hljs-built_in">console</span>.log chalk.magenta err.message
            <span class="hljs-built_in">console</span>.log err.description <span class="hljs-keyword">if</span> err.description
            <span class="hljs-keyword">return</span> cb err
          data[key] = result ? base
          cb()
    , <span class="hljs-function"><span class="hljs-params">(err)</span> -&gt;</span>
      readline.close()
      cb err
  , <span class="hljs-function"><span class="hljs-params">(err)</span> -&gt;</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">''</span>
    cb err, data</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
