<!DOCTYPE html>
<html>
<head>
  <title>diskfree.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "home/alex/github/node-monitor/src/sensor/diskfree.coffee";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0" /></head>
<body>
  <nav>
<div class="logo"><a href="http://alinex.github.io"
  onmouseover="logo.src='https://alinex.github.io/images/Alinex-200.png'"
  onmouseout="logo.src='https://alinex.github.io/images/Alinex-black-200.png'">
  <img name="logo" src="https://alinex.github.io/images/Alinex-black-200.png"
    width="150" title="Alinex Universe Homepage" />
  </a>
  <img src="http://alinex.github.io/images/Alinex-200.png"
    style="display:none" alt="preloading" />
</div>
<div class="links">
  <a href="http://alinex.github.io/blog"
    class="btn btn-primary"><span class="glyphicon-pencil"></span> Blog</a>
  <a href="http://alinex.github.io/develop"
    class="btn btn-primary"><span class="glyphicon-book"></span> Develop</a>
  <a href="http://alinex.github.io/code.html"
    class="btn btn-warning"><span class="glyphicon-cog"></span> Code</a>
</div>
</nav><div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#check-disk-space">Check disk space</a>
      </div>

      <div class="heading h2">
        <a href="#node-modules">Node Modules</a>
      </div>

      <div class="heading h2">
        <a href="#schema-definition">Schema Definition</a>
      </div>

      <div class="heading h2">
        <a href="#general-information">General information</a>
      </div>

      <div class="heading h3">
        <a href="#result-values">Result values</a>
      </div>

      <div class="heading h2">
        <a href="#initialize-check">Initialize check</a>
      </div>

      <div class="heading h2">
        <a href="#run-the-sensor">Run the Sensor</a>
      </div>

      <div class="heading h2">
        <a href="#get-the-results">Get the results</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container" tabindex="0"><a id="fork" href="https://github.com/alinex/node-monitor" title="Fork me on GitHub"></a>
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="check-disk-space">
  <h1>
    <a href="#check-disk-space" name="check-disk-space" class="pilcrow"></a>
Check disk space
  </h1>
</div>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Find the description of the possible configuration values and the returned
values in the code below.</p>
<p>This methods will be called in the context of the corresponding check()
instance.</p>
<p>The analysis part currently is based on debian linux.</p>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="node-modules">
  <h2>
    <a href="#node-modules" name="node-modules" class="pilcrow"></a>
Node Modules
  </h2>
</div>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>include base modules</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'debug'</span>)(<span class="hljs-string">'monitor:sensor:diskfree'</span>)</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>include alinex modules</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">config = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-config'</span>
Exec = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-exec'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="schema-definition">
  <h2>
    <a href="#schema-definition" name="schema-definition" class="pilcrow"></a>
Schema Definition
  </h2>
</div>
<p>This is used as configuration specification and to add the default values for
specific setting.</p>
<p>It's a n<a href="http://alinex.githhub.io/node-validator">alinex-validator</a>
compatible schema definition:</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.schema =
  <span class="hljs-attribute">title</span>: <span class="hljs-string">"Disk Free Test"</span>
  <span class="hljs-attribute">description</span>: <span class="hljs-string">"the setup for a check for free disk space"</span>
  <span class="hljs-attribute">type</span>: <span class="hljs-string">'object'</span>
  <span class="hljs-attribute">allowedKeys</span>: <span class="hljs-literal">true</span>
  <span class="hljs-attribute">keys</span>:
    <span class="hljs-attribute">remote</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">"Remote Server"</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"the remote server on which to run the command"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'string'</span>
      <span class="hljs-attribute">values</span>: Object.keys config.get(<span class="hljs-string">'/exec/remote/server'</span>) ? {}
    <span class="hljs-attribute">share</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">"Share or Mount"</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"the disk share's path or mount point to check"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'string'</span>
    <span class="hljs-attribute">timeout</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">"Measurement Time"</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"the time in milliseconds the whole test may take before
        stopping and failing it"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'interval'</span>
      <span class="hljs-attribute">unit</span>: <span class="hljs-string">'ms'</span>
      <span class="hljs-attribute">min</span>: <span class="hljs-number">500</span>
      <span class="hljs-attribute">default</span>: <span class="hljs-number">5000</span>
    <span class="hljs-attribute">warn</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">"Warn if"</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"the javascript code to check to set status to warn"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'string'</span>
      <span class="hljs-attribute">optional</span>: <span class="hljs-literal">true</span>
      <span class="hljs-attribute">default</span>: <span class="hljs-string">'freePercent &lt; 10%'</span>
    <span class="hljs-attribute">fail</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">"Fail if"</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"the javascript code to check to set status to fail"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'string'</span>
      <span class="hljs-attribute">optional</span>: <span class="hljs-literal">true</span>
      <span class="hljs-attribute">default</span>: <span class="hljs-string">'free is 0'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="general-information">
  <h2>
    <a href="#general-information" name="general-information" class="pilcrow"></a>
General information
  </h2>
</div>
<p>This information may be used later for display and explanation.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.meta =
  <span class="hljs-attribute">title</span>: <span class="hljs-string">'Diskfree'</span>
  <span class="hljs-attribute">description</span>: <span class="hljs-string">"Test the free diskspace of one share."</span>
  <span class="hljs-attribute">category</span>: <span class="hljs-string">'sys'</span>
  <span class="hljs-attribute">hint</span>: <span class="hljs-string">"If a share is full it will make I/O problems in the system or applications
  in case of the root partition it may also neither be possible to log errors.
  Maybe some old files like temp or logs can be removed or compressed. "</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="result-values">
  <h3>
    <a href="#result-values" name="result-values" class="pilcrow"></a>
Result values
  </h3>
</div>
<p>This are possible values which may be given if the check runs normally.
You may use any of these in your warn/fail expressions.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-attribute">values</span>:
    <span class="hljs-attribute">share</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">'Share'</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"path name of the share"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'string'</span>
    <span class="hljs-attribute">type</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">'Type'</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"type of filesystem"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'string'</span>
    <span class="hljs-attribute">mount</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">'Mountpoint'</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"the path this share is mounted to"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'string'</span>
    <span class="hljs-attribute">total</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">'Available'</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"the space, which is available"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'byte'</span>
      <span class="hljs-attribute">unit</span>: <span class="hljs-string">'B'</span>
    <span class="hljs-attribute">used</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">'Used'</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"the space, which is already used"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'byte'</span>
      <span class="hljs-attribute">unit</span>: <span class="hljs-string">'B'</span>
    <span class="hljs-attribute">usedPercent</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">'% Used'</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"the space, which is already used"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'percent'</span>
    <span class="hljs-attribute">free</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">'Free'</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"the space, which is free"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'byte'</span>
      <span class="hljs-attribute">unit</span>: <span class="hljs-string">'B'</span>
    <span class="hljs-attribute">freePercent</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">'% Free'</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"the space, which is free"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'percent'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="initialize-check">
  <h2>
    <a href="#initialize-check" name="initialize-check" class="pilcrow"></a>
Initialize check
  </h2>
</div>
<p>This method is used for some precalculations or analyzations and should set:</p>
<ul>
<li>check.name = <string> # mandatory</li>
<li>check.base = <object> # optionally</li>
</ul>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.init = <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span>
  <span class="hljs-property">@name</span> ?= <span class="hljs-string">"<span class="hljs-subst">#{<span class="hljs-property">@conf</span>.remote ? <span class="hljs-string">'localhost'</span>}</span>:<span class="hljs-subst">#{<span class="hljs-property">@conf</span>.share}</span>"</span>
  cb()</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="run-the-sensor">
  <h2>
    <a href="#run-the-sensor" name="run-the-sensor" class="pilcrow"></a>
Run the Sensor
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.run = <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>run check</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  Exec.run
    <span class="hljs-attribute">remote</span>: <span class="hljs-property">@conf</span>.remote
    <span class="hljs-attribute">cmd</span>: <span class="hljs-string">'df'</span>
    <span class="hljs-attribute">args</span>: [<span class="hljs-string">'-kT'</span>, <span class="hljs-property">@conf</span>.share]
    <span class="hljs-attribute">priority</span>: <span class="hljs-string">'immediately'</span>
    <span class="hljs-attribute">timeout</span>: <span class="hljs-property">@conf</span>.timeout
    <span class="hljs-attribute">check</span>:
      <span class="hljs-attribute">noExitCode</span>: <span class="hljs-literal">true</span>
      <span class="hljs-attribute">stdout</span>: <span class="hljs-literal">true</span>
  , cb</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="get-the-results">
  <h2>
    <a href="#get-the-results" name="get-the-results" class="pilcrow"></a>
Get the results
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.calc = <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span>
  <span class="hljs-keyword">return</span> cb() <span class="hljs-keyword">if</span> <span class="hljs-property">@err</span>
  res = <span class="hljs-property">@result</span>.data</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>cpu info values</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  lines = res.stdout().split <span class="hljs-regexp">/\n/</span>
  col = lines[<span class="hljs-number">1</span>].split <span class="hljs-regexp">/\s+/</span>
  <span class="hljs-property">@values</span>.share = col[<span class="hljs-number">0</span>]
  <span class="hljs-property">@values</span>.type = col[<span class="hljs-number">1</span>]
  <span class="hljs-property">@values</span>.used = Number(col[<span class="hljs-number">3</span>])*<span class="hljs-number">1024</span>
  <span class="hljs-property">@values</span>.free = Number(col[<span class="hljs-number">4</span>])*<span class="hljs-number">1024</span>
  <span class="hljs-property">@values</span>.total = <span class="hljs-property">@values</span>.used + <span class="hljs-property">@values</span>.free
  <span class="hljs-property">@values</span>.mount = col[<span class="hljs-number">6</span>]
  <span class="hljs-property">@values</span>.usedPercent = <span class="hljs-property">@values</span>.used / <span class="hljs-property">@values</span>.total
  <span class="hljs-property">@values</span>.freePercent = <span class="hljs-property">@values</span>.free / <span class="hljs-property">@values</span>.total
  cb()</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
