<!DOCTYPE html>
<html>
<head>
  <title>user.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "home/alex/github/node-monitor/src/sensor/user.coffee";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0" /></head>
<body>
  <nav>
<div class="logo"><a href="http://alinex.github.io"
  onmouseover="logo.src='https://alinex.github.io/images/Alinex-200.png'"
  onmouseout="logo.src='https://alinex.github.io/images/Alinex-black-200.png'">
  <img name="logo" src="https://alinex.github.io/images/Alinex-black-200.png"
    width="150" title="Alinex Universe Homepage" />
  </a>
  <img src="http://alinex.github.io/images/Alinex-200.png"
    style="display:none" alt="preloading" />
</div>
<div class="links">
  <a href="http://alinex.github.io/blog"
    class="btn btn-primary"><span class="glyphicon-pencil"></span> Blog</a>
  <a href="http://alinex.github.io/develop"
    class="btn btn-primary"><span class="glyphicon-book"></span> Develop</a>
  <a href="http://alinex.github.io/code.html"
    class="btn btn-warning"><span class="glyphicon-cog"></span> Code</a>
</div>
</nav><div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#check-disk-space">Check disk space</a>
      </div>

      <div class="heading h2">
        <a href="#node-modules">Node Modules</a>
      </div>

      <div class="heading h2">
        <a href="#schema-definition">Schema Definition</a>
      </div>

      <div class="heading h2">
        <a href="#general-information">General information</a>
      </div>

      <div class="heading h3">
        <a href="#result-values">Result values</a>
      </div>

      <div class="heading h2">
        <a href="#initialize-check">Initialize check</a>
      </div>

      <div class="heading h2">
        <a href="#run-the-sensor">Run the Sensor</a>
      </div>

      <div class="heading h2">
        <a href="#get-the-results">Get the results</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container" tabindex="0"><a id="fork" href="https://github.com/alinex/node-monitor" title="Fork me on GitHub"></a>
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="check-disk-space">
  <h1>
    <a href="#check-disk-space" name="check-disk-space" class="pilcrow"></a>
Check disk space
  </h1>
</div>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Find the description of the possible configuration values and the returned
values in the code below.</p>
<p>This methods will be called in the context of the corresponding check()
instance.</p>
<p>The analysis part currently is based on debian linux.</p>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="node-modules">
  <h2>
    <a href="#node-modules" name="node-modules" class="pilcrow"></a>
Node Modules
  </h2>
</div>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>include base modules</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'debug'</span>)(<span class="hljs-string">'monitor:sensor:user'</span>)</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>include alinex modules</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">config = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-config'</span>
async = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-async'</span>
Exec = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-exec'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="schema-definition">
  <h2>
    <a href="#schema-definition" name="schema-definition" class="pilcrow"></a>
Schema Definition
  </h2>
</div>
<p>This is used as configuration specification and to add the default values for
specific setting.</p>
<p>It's a n<a href="http://alinex.githhub.io/node-validator">alinex-validator</a>
compatible schema definition:</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.schema =
  <span class="hljs-attribute">title</span>: <span class="hljs-string">"User Check"</span>
  <span class="hljs-attribute">description</span>: <span class="hljs-string">"the setup to check for an active users"</span>
  <span class="hljs-attribute">type</span>: <span class="hljs-string">'object'</span>
  <span class="hljs-attribute">allowedKeys</span>: <span class="hljs-literal">true</span>
  <span class="hljs-attribute">mandatoryKeys</span>: [<span class="hljs-string">'user'</span>]
  <span class="hljs-attribute">keys</span>:
    <span class="hljs-attribute">remote</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">"Remote Server"</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"the remote server on which to run the command"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'string'</span>
      <span class="hljs-attribute">values</span>: Object.keys config.get(<span class="hljs-string">'/exec/remote/server'</span>) ? {}
    <span class="hljs-attribute">user</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">"Username to check"</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"the local user name to check"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'string'</span>
    <span class="hljs-attribute">warn</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">"Warn if"</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"the javascript code to check to set status to warn"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'string'</span>
      <span class="hljs-attribute">optional</span>: <span class="hljs-literal">true</span>
    <span class="hljs-attribute">fail</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">"Fail if"</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"the javascript code to check to set status to fail"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'string'</span>
      <span class="hljs-attribute">optional</span>: <span class="hljs-literal">true</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="general-information">
  <h2>
    <a href="#general-information" name="general-information" class="pilcrow"></a>
General information
  </h2>
</div>
<p>This information may be used later for display and explanation.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.meta =
  <span class="hljs-attribute">title</span>: <span class="hljs-string">'Active User'</span>
  <span class="hljs-attribute">description</span>: <span class="hljs-string">"Check what an active user do."</span>
  <span class="hljs-attribute">category</span>: <span class="hljs-string">'sys'</span>
  <span class="hljs-attribute">hint</span>: <span class="hljs-string">"This check will give an overview of the activities of an (logged in) user.
  If you look at the processes you may find out that some other warnings
  like high load are user made and you may contact this person directly. "</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="result-values">
  <h3>
    <a href="#result-values" name="result-values" class="pilcrow"></a>
Result values
  </h3>
</div>
<p>This are possible values which may be given if the check runs normally.
You may use any of these in your warn/fail expressions.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-attribute">values</span>:
    <span class="hljs-attribute">num</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">'Processes'</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"number of running processes"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'integer'</span>
    <span class="hljs-attribute">cpu</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">'% CPU'</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"usage of CPU"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'percent'</span>
    <span class="hljs-attribute">memory</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">'% Memory'</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"usage of Memory"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'percent'</span>
    <span class="hljs-attribute">rss</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">'Physical Memory'</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"resident set size, the non-swapped physical memory"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'byte'</span>
      <span class="hljs-attribute">unit</span>: <span class="hljs-string">'B'</span>
    <span class="hljs-attribute">vss</span>:
      <span class="hljs-attribute">title</span>: <span class="hljs-string">'Virtual Memory'</span>
      <span class="hljs-attribute">description</span>: <span class="hljs-string">"virtual memory usage"</span>
      <span class="hljs-attribute">type</span>: <span class="hljs-string">'byte'</span>
      <span class="hljs-attribute">unit</span>: <span class="hljs-string">'B'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="initialize-check">
  <h2>
    <a href="#initialize-check" name="initialize-check" class="pilcrow"></a>
Initialize check
  </h2>
</div>
<p>This method is used for some precalculations or analyzations and should set:</p>
<ul>
<li>check.name = <string> # mandatory</li>
<li>check.base = <object> # optionally</li>
</ul>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.init = <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span>
  <span class="hljs-property">@name</span> ?= <span class="hljs-property">@conf</span>.remote ? <span class="hljs-string">'localhost'</span>
  cb()</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="run-the-sensor">
  <h2>
    <a href="#run-the-sensor" name="run-the-sensor" class="pilcrow"></a>
Run the Sensor
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.run = <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>run check</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  async.map [
    <span class="hljs-attribute">remote</span>: <span class="hljs-property">@conf</span>.remote
    <span class="hljs-attribute">cmd</span>: <span class="hljs-string">'sh'</span>
    <span class="hljs-attribute">args</span>: [<span class="hljs-string">'-c'</span>, <span class="hljs-string">"ps -U <span class="hljs-subst">#{<span class="hljs-property">@conf</span>.user}</span> --no-headers -o pcpu,pmem,vsz,rss
    | awk '{n++; pcpu+=$1; pmem+=$2; rss+=$3; vmem+=$4}
    END{print n\" \"pcpu\" \"pmem\" \"rss\" \"vmem}'"</span>]
    <span class="hljs-attribute">priority</span>: <span class="hljs-string">'immediately'</span>
  ,
    <span class="hljs-attribute">remote</span>: <span class="hljs-property">@conf</span>.remote
    <span class="hljs-attribute">cmd</span>: <span class="hljs-string">'sh'</span>
    <span class="hljs-attribute">args</span>: [<span class="hljs-string">'-c'</span>, <span class="hljs-string">"grep processor /proc/cpuinfo | wc -l"</span>]
    <span class="hljs-attribute">priority</span>: <span class="hljs-string">'immediately'</span>
  ], <span class="hljs-function"><span class="hljs-params">(setup, cb)</span> -&gt;</span>
    Exec.run setup, cb
  , cb</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="get-the-results">
  <h2>
    <a href="#get-the-results" name="get-the-results" class="pilcrow"></a>
Get the results
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.calc = <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span>
  <span class="hljs-keyword">return</span> cb() <span class="hljs-keyword">if</span> <span class="hljs-property">@err</span>
  res = <span class="hljs-property">@result</span>.data
  cpus = Number res[<span class="hljs-number">1</span>].stdout()
  col = res[<span class="hljs-number">0</span>].stdout().split <span class="hljs-regexp">/\s+/</span>
  <span class="hljs-property">@values</span>.num = Number col[<span class="hljs-number">0</span>]
  <span class="hljs-property">@values</span>.cpu = Number(col[<span class="hljs-number">1</span>]) / <span class="hljs-number">100</span> / cpus
  <span class="hljs-property">@values</span>.memory = Number(col[<span class="hljs-number">2</span>]) / <span class="hljs-number">100</span>
  <span class="hljs-property">@values</span>.rss = Number col[<span class="hljs-number">3</span>]
  <span class="hljs-property">@values</span>.vss = Number col[<span class="hljs-number">4</span>]
  cb()</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
