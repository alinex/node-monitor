<!DOCTYPE html>
<html>
<head>
  <title>explorer.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../";
    var thisFile = "home/alex/github/node-monitor/src/explorer.coffee";
    var defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0" /></head>
<body>
  <nav>
<div class="logo"><a href="http://alinex.github.io"
  onmouseover="logo.src='https://alinex.github.io/images/Alinex-200.png'"
  onmouseout="logo.src='https://alinex.github.io/images/Alinex-black-200.png'">
  <img name="logo" src="https://alinex.github.io/images/Alinex-black-200.png"
    width="150" title="Alinex Universe Homepage" />
  </a>
  <img src="http://alinex.github.io/images/Alinex-200.png"
    style="display:none" alt="preloading" />
</div>
<div class="links">
  <a href="http://alinex.github.io/blog"
    class="btn btn-primary"><span class="glyphicon-pencil"></span> Blog</a>
  <a href="http://alinex.github.io/develop"
    class="btn btn-primary"><span class="glyphicon-book"></span> Develop</a>
  <a href="http://alinex.github.io/code.html"
    class="btn btn-warning"><span class="glyphicon-cog"></span> Code</a>
</div>
</nav><div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#helper-for-the-explorer-modules">Helper for the explorer modules</a>
      </div>

      <div class="heading h2">
        <a href="#node-modules">Node Modules</a>
      </div>

      <div class="heading h2">
        <a href="#start-a-new-run">Start a new Run</a>
      </div>

      <div class="heading h2">
        <a href="#end-a-run">End a Run</a>
      </div>

      <div class="heading h3">
        <a href="#format-a-value-for-better-human-readable-display">Format a value for better human readable display</a>
      </div>

      <div class="heading h3">
        <a href="#convert-object-to-markdown-table">Convert object to markdown table</a>
      </div>

      <div class="heading h3">
        <a href="#check-expression-against-string">Check expression against string</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container" tabindex="0"><a id="fork" href="https://github.com/alinex/node-monitor" title="Fork me on GitHub"></a>
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="helper-for-the-explorer-modules">
  <h1>
    <a href="#helper-for-the-explorer-modules" name="helper-for-the-explorer-modules" class="pilcrow"></a>
Helper for the explorer modules
  </h1>
</div>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="node-modules">
  <h2>
    <a href="#node-modules" name="node-modules" class="pilcrow"></a>
Node Modules
  </h2>
</div>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>include base modules</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">chalk = <span class="hljs-built_in">require</span> <span class="hljs-string">'chalk'</span>
math = <span class="hljs-built_in">require</span> <span class="hljs-string">'mathjs'</span>
named = <span class="hljs-built_in">require</span>(<span class="hljs-string">'named-regexp'</span>).named</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>include alinex modules</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">{string} = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-util'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>include classes and helpers</p>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="start-a-new-run">
  <h2>
    <a href="#start-a-new-run" name="start-a-new-run" class="pilcrow"></a>
Start a new Run
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.start = <span class="hljs-function"><span class="hljs-params">(work)</span> -&gt;</span>
  work.explorer.debug <span class="hljs-string">"<span class="hljs-subst">#{chalk.grey work.explorer.name work.config}</span> start check"</span>
  work.result.date = [<span class="hljs-keyword">new</span> Date()]
  work.result.values = {}</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="end-a-run">
  <h2>
    <a href="#end-a-run" name="end-a-run" class="pilcrow"></a>
End a Run
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.end = <span class="hljs-function"><span class="hljs-params">(work)</span> -&gt;</span>
  work.explorer.debug <span class="hljs-string">"<span class="hljs-subst">#{chalk.grey work.explorer.name work.config}</span> ended check"</span>
  work.result.date[<span class="hljs-number">1</span>] = <span class="hljs-keyword">new</span> Date()






exports.report = <span class="hljs-function"><span class="hljs-params">(work)</span> -&gt;</span>
  meta = work.explorer.meta
  name = work.explorer.name work.config
  name = <span class="hljs-string">"(<span class="hljs-subst">#{name}</span>)"</span> <span class="hljs-keyword">if</span> name
  report = <span class="hljs-string">"""\n<span class="hljs-subst">#{meta.title}</span> <span class="hljs-subst">#{name}</span>
  ------------------------------------------------------------------------------\n
  """</span>
  report += <span class="hljs-string">"""\n<span class="hljs-subst">#{string.wordwrap meta.description, <span class="hljs-number">78</span>}</span>

  Last check results from <span class="hljs-subst">#{work.result.date[<span class="hljs-number">0</span>]}</span> are:

  |          LABEL          |                     VALUE                        |
  | ----------------------- | -----------------------------------------------: |\n
  """</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>table of values</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">for</span> name, set <span class="hljs-keyword">of</span> meta.values
    val = <span class="hljs-string">''</span>
    <span class="hljs-keyword">if</span> work.result.values[name]?
      val = formatValue work.result.values[name], set
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> val <span class="hljs-keyword">is</span> <span class="hljs-string">'object'</span>
      <span class="hljs-keyword">for</span> n, v <span class="hljs-keyword">of</span> val
        report += <span class="hljs-string">"| <span class="hljs-subst">#{string.rpad (set.title + <span class="hljs-string">': '</span> + n), <span class="hljs-number">23</span>}</span>
        | <span class="hljs-subst">#{string.lpad v.toString(), <span class="hljs-number">48</span>}</span> |\n"</span>
    <span class="hljs-keyword">else</span>
      report += <span class="hljs-string">"| <span class="hljs-subst">#{string.rpad set.title, <span class="hljs-number">23</span>}</span> | <span class="hljs-subst">#{string.lpad val.toString(), <span class="hljs-number">48</span>}</span> |\n"</span>
  <span class="hljs-keyword">if</span> work.sensor.meta.hint
    report += <span class="hljs-string">"\n&gt; <span class="hljs-subst">#{string.wordwrap work.sensor.meta.hint, <span class="hljs-number">76</span>, <span class="hljs-string">'\n&gt; '</span>}</span>\n"</span>
  found = <span class="hljs-literal">false</span>
  <span class="hljs-keyword">for</span> name, set <span class="hljs-keyword">of</span> work.sensor.schema.keys
    <span class="hljs-keyword">continue</span> <span class="hljs-keyword">if</span> name <span class="hljs-keyword">is</span> <span class="hljs-string">'analysis'</span>
    <span class="hljs-keyword">continue</span> <span class="hljs-keyword">unless</span> work.config[name]?
    <span class="hljs-keyword">unless</span> found
      found = <span class="hljs-literal">true</span>
      report += <span class="hljs-string">"""\nThis has been checked with the following setup:

      |       CONFIG       |  VALUE                                                |
      | ------------------ | ----------------------------------------------------: |\n
      """</span>
    val = formatValue work.config[name], set
    <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> [<span class="hljs-string">'fail'</span>, <span class="hljs-string">'warn'</span>]</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>replace values</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      <span class="hljs-keyword">for</span> vname <span class="hljs-keyword">of</span> work.result.values
        re = <span class="hljs-keyword">new</span> RegExp <span class="hljs-string">"\\b<span class="hljs-subst">#{vname}</span>\\b"</span>, <span class="hljs-string">'g'</span>
        val = val.replace re, <span class="hljs-function"><span class="hljs-params">(str)</span> -&gt;</span>
          meta.values[str]?.title ? str
    report += <span class="hljs-string">"| <span class="hljs-subst">#{string.rpad set.title, <span class="hljs-number">18</span>}</span>
    | <span class="hljs-subst">#{string.lpad val.toString(), <span class="hljs-number">53</span>}</span> |\n"</span>
  report += <span class="hljs-string">"\n<span class="hljs-subst">#{work.result.analysis}</span>\n"</span> <span class="hljs-keyword">if</span> work.result.analysis
  <span class="hljs-keyword">if</span> work.hint
    context =
      <span class="hljs-attribute">name</span>: work.sensor.name work.config
      <span class="hljs-attribute">config</span>: work.config
      <span class="hljs-attribute">results</span>: work.result
      <span class="hljs-attribute">meta</span>: work.meta
    report += <span class="hljs-string">"\n&gt; <span class="hljs-subst">#{string.wordwrap work.hint(context), <span class="hljs-number">76</span>, <span class="hljs-string">'\n&gt; '</span>}</span>\n"</span>
  report <span class="hljs-comment">#  string.wordwrap report</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="format-a-value-for-better-human-readable-display">
  <h3>
    <a href="#format-a-value-for-better-human-readable-display" name="format-a-value-for-better-human-readable-display" class="pilcrow"></a>
Format a value for better human readable display
  </h3>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript"><span class="hljs-function"><span class="hljs-title">formatValue</span> = <span class="hljs-params">(value, config)</span> -&gt;</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>format with autodetect</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">unless</span> config
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">switch</span>
      <span class="hljs-keyword">when</span> <span class="hljs-keyword">typeof</span> value <span class="hljs-keyword">is</span> <span class="hljs-string">'number'</span>
        parts = (Math.round(value * <span class="hljs-number">100</span>) / <span class="hljs-number">100</span>).toString().split <span class="hljs-string">'.'</span>
        parts[<span class="hljs-number">0</span>] = parts[<span class="hljs-number">0</span>].replace <span class="hljs-regexp">/\B(?=(\d{3})+(?!\d))/g</span>, <span class="hljs-string">","</span>
        parts.join <span class="hljs-string">'.'</span>
      <span class="hljs-keyword">else</span>
        value</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>format using config setting</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">switch</span> config.type
    <span class="hljs-keyword">when</span> <span class="hljs-string">'percent'</span>
      Math.round(value * <span class="hljs-number">100</span>).toString() + <span class="hljs-string">' %'</span>
    <span class="hljs-keyword">when</span> <span class="hljs-string">'byte'</span>
      byte = math.unit value, <span class="hljs-string">'B'</span>
      byte.format <span class="hljs-number">3</span>
    <span class="hljs-keyword">when</span> <span class="hljs-string">'interval'</span>
      long =
        <span class="hljs-attribute">d</span>: <span class="hljs-string">'day'</span>
        <span class="hljs-attribute">m</span>: <span class="hljs-string">'minute'</span>
      unit = long[config.unit] ? config.unit
      interval = math.unit value, unit
      interval = interval.to <span class="hljs-string">'m'</span> <span class="hljs-keyword">if</span> interval.toNumber(<span class="hljs-string">'s'</span>) &gt; <span class="hljs-number">120</span>
      interval.format()
    <span class="hljs-keyword">when</span> <span class="hljs-string">'float'</span>
      parts = (Math.round(value * <span class="hljs-number">100</span>) / <span class="hljs-number">100</span>).toString().split <span class="hljs-string">'.'</span>
      parts[<span class="hljs-number">0</span>] = parts[<span class="hljs-number">0</span>].replace <span class="hljs-regexp">/\B(?=(\d{3})+(?!\d))/g</span>, <span class="hljs-string">","</span>
      parts.join <span class="hljs-string">'.'</span>
    <span class="hljs-keyword">else</span>
      val = value
      val += <span class="hljs-string">" <span class="hljs-subst">#{config.unit}</span>"</span> <span class="hljs-keyword">if</span> val <span class="hljs-keyword">and</span> config.unit
      val</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="convert-object-to-markdown-table">
  <h3>
    <a href="#convert-object-to-markdown-table" name="convert-object-to-markdown-table" class="pilcrow"></a>
Convert object to markdown table
  </h3>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.formatTable = <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span>
  result = <span class="hljs-string">''</span>
  <span class="hljs-keyword">unless</span> Array.isArray obj</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>single object</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    keys = Object.keys obj</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>get length of heading</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    maxlen = []
    <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> keys
      maxlen[<span class="hljs-number">0</span>] = n.length <span class="hljs-keyword">if</span> maxlen[<span class="hljs-number">0</span>] &lt; n.length
      maxlen[<span class="hljs-number">1</span>] = obj[n].length <span class="hljs-keyword">if</span> maxlen[<span class="hljs-number">1</span>] &lt; obj[n].length</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>create table</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    result = <span class="hljs-string">"| <span class="hljs-subst">#{string.rpad <span class="hljs-string">'Name'</span>, maxlen[<span class="hljs-number">0</span>]}</span> | <span class="hljs-subst">#{string.lpad <span class="hljs-string">'Value'</span>, maxlen[<span class="hljs-number">1</span>]}</span> |\n"</span>
    result = <span class="hljs-string">"| <span class="hljs-subst">#{string.repeat <span class="hljs-string">'-'</span>, maxlen[<span class="hljs-number">0</span>]}</span> | <span class="hljs-subst">#{string.repeat <span class="hljs-string">'-'</span>, maxlen[<span class="hljs-number">1</span>]}</span> |\n"</span>
    <span class="hljs-keyword">for</span> n, v <span class="hljs-keyword">in</span> obj
      result = <span class="hljs-string">"| <span class="hljs-subst">#{string.rpad n, maxlen[<span class="hljs-number">0</span>]}</span> | <span class="hljs-subst">#{string.lpad formatValue(v), maxlen[<span class="hljs-number">1</span>]}</span> |\n"</span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> obj.length</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>List of objects</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    keys = Object.keys obj[<span class="hljs-number">0</span>]</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>get length of heading</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    maxlen = {}
    <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> keys
      maxlen[n] = n.length
    <span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> obj
      <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> keys
        maxlen[n] = e[n].length <span class="hljs-keyword">if</span> maxlen[n] &lt; e[n].length</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>create table</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    row = keys.map (n) -&gt;
      string.lpad string.ucFirst(n), maxlen[n]
    result = <span class="hljs-string">"| <span class="hljs-subst">#{row.join <span class="hljs-string">' | '</span>}</span> |\n"</span>
    row = keys.map (n) -&gt;
      string.repeat <span class="hljs-string">'-'</span>, maxlen[n] - <span class="hljs-number">1</span>
    result += <span class="hljs-string">"| <span class="hljs-subst">#{row.join <span class="hljs-string">': | '</span>}</span>: |\n"</span>
    <span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> obj
      row = keys.map (n) -&gt;
        string.lpad formatValue(e[n]), maxlen[n]
      result += <span class="hljs-string">"| <span class="hljs-subst">#{row.join <span class="hljs-string">' | '</span>}</span> |\n"</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>return result</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  result</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="check-expression-against-string">
  <h3>
    <a href="#check-expression-against-string" name="check-expression-against-string" class="pilcrow"></a>
Check expression against string
  </h3>
</div>
<p>It will will try to match the given expression once and return the matched
groups or false if not matched. The groups are a array with the full match as
first element or in case of named regexp an object with key 'match' containing
the full match.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">exports.match = <span class="hljs-function"><span class="hljs-params">(text, re)</span> -&gt;</span>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-keyword">unless</span> re?
  <span class="hljs-keyword">unless</span> re <span class="hljs-keyword">instanceof</span> RegExp
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> Boolean ~text.indexOf re <span class="hljs-keyword">then</span> [re] <span class="hljs-keyword">else</span> <span class="hljs-literal">false</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>it's an regular expression</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  useNamed = ~re.toString().indexOf <span class="hljs-string">'(:&lt;'</span>
  re = named re <span class="hljs-keyword">if</span> useNamed
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-keyword">unless</span> match = re.exec text
  <span class="hljs-keyword">if</span> useNamed
    matches = {}
    matches[name] = match.capture name <span class="hljs-keyword">for</span> name <span class="hljs-keyword">of</span> match.captures
  <span class="hljs-keyword">else</span>
    matches = match[<span class="hljs-number">0.</span>.match.length]
  <span class="hljs-keyword">return</span> matches</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
